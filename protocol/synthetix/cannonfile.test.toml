# overrides to create a testable deployment of the core system
version = "<%= package.version %>-testable"
include = ["cannonfile.toml"]

# use the testable oracle manager
[var.testableMain]
oracle_manager_source = "oracle-manager:<%= package.version %>-testable"

# Test Modules
[deploy.TestableAccountStorage]
artifact = "contracts/generated/test/TestableAccountStorage.sol:TestableAccountStorage"

[deploy.TestableAccountRBACStorage]
artifact = "contracts/generated/test/TestableAccountRBACStorage.sol:TestableAccountRBACStorage"

[deploy.TestableCollateralStorage]
artifact = "contracts/generated/test/TestableCollateralStorage.sol:TestableCollateralStorage"

[deploy.TestableCollateralConfigurationStorage]
artifact = "contracts/generated/test/TestableCollateralConfigurationStorage.sol:TestableCollateralConfigurationStorage"

[deploy.TestableCollateralLockStorage]
artifact = "contracts/generated/test/TestableCollateralLockStorage.sol:TestableCollateralLockStorage"

[deploy.TestableCrossChainStorage]
artifact = "contracts/generated/test/TestableCrossChainStorage.sol:TestableCrossChainStorage"

[deploy.TestableDistributionStorage]
artifact = "contracts/generated/test/TestableDistributionStorage.sol:TestableDistributionStorage"

[deploy.TestableDistributionActorStorage]
artifact = "contracts/generated/test/TestableDistributionActorStorage.sol:TestableDistributionActorStorage"

[deploy.TestableMarketStorage]
artifact = "contracts/generated/test/TestableMarketStorage.sol:TestableMarketStorage"

[deploy.TestableMarketConfigurationStorage]
artifact = "contracts/generated/test/TestableMarketConfigurationStorage.sol:TestableMarketConfigurationStorage"

[deploy.TestableMarketPoolInfoStorage]
artifact = "contracts/generated/test/TestableMarketPoolInfoStorage.sol:TestableMarketPoolInfoStorage"

[deploy.TestablePoolStorage]
artifact = "contracts/generated/test/TestablePoolStorage.sol:TestablePoolStorage"

[deploy.TestableSystemPoolConfigurationStorage]
artifact = "contracts/generated/test/TestableSystemPoolConfigurationStorage.sol:TestableSystemPoolConfigurationStorage"

[deploy.TestableRewardDistributionStorage]
artifact = "contracts/generated/test/TestableRewardDistributionStorage.sol:TestableRewardDistributionStorage"

[deploy.TestableRewardDistributionClaimStatusStorage]
artifact = "contracts/generated/test/TestableRewardDistributionClaimStatusStorage.sol:TestableRewardDistributionClaimStatusStorage"

[deploy.TestableScalableMappingStorage]
artifact = "contracts/generated/test/TestableScalableMappingStorage.sol:TestableScalableMappingStorage"

[deploy.TestableVaultEpochStorage]
artifact = "contracts/generated/test/TestableVaultEpochStorage.sol:TestableVaultEpochStorage"

[deploy.TestableVaultStorage]
artifact = "contracts/generated/test/TestableVaultStorage.sol:TestableVaultStorage"

# Core
[router.CoreRouter]
contracts = [
    "InitialModuleBundle",
    "FeatureFlagModule",
    "AccountModule",
    "AssociateDebtModule",
    "AssociatedSystemsModule",
    "CcipReceiverModule",
    "CollateralModule",
    "CollateralConfigurationModule",
    "CrossChainUSDModule",
    "IssueUSDModule",
    "LiquidationModule",
    "MarketCollateralModule",
    "MarketManagerModule",
    "PoolConfigurationModule",
    "PoolModule",
    "RewardsManagerModule",
    "UtilsModule",
    "VaultModule",
    "TestableAccountStorage",
    "TestableAccountRBACStorage",
    "TestableCollateralStorage",
    "TestableCollateralConfigurationStorage",
    "TestableCollateralLockStorage",
    "TestableCrossChainStorage",
    "TestableDistributionStorage",
    "TestableDistributionActorStorage",
    "TestableMarketStorage",
    "TestableMarketConfigurationStorage",
    "TestablePoolStorage",
    "TestableSystemPoolConfigurationStorage",
    "TestableRewardDistributionStorage",
    "TestableRewardDistributionClaimStatusStorage",
    "TestableScalableMappingStorage",
    "TestableVaultEpochStorage",
    "TestableVaultStorage",
]

# Post stuff
[deploy.CollateralMock]
artifact = "contracts/mocks/CollateralMock.sol:CollateralMock"

[deploy.Collateral2Mock]
artifact = "contracts/mocks/CollateralMock.sol:CollateralMock"
salt = "2"

[invoke.intializeCollateralMock]
target = ["CollateralMock"]
func = "initialize"
args = ["SampleToken", "TKN", "18"]

[invoke.enable_feature_registerMarket]
target = ["CoreProxy"]
fromCall.func = "owner"
func = "setFeatureFlagAllowAll"
args = ["<%= formatBytes32String('registerMarket') %>", true]

[invoke.enable_feature_createPool]
target = ["CoreProxy"]
fromCall.func = "owner"
func = "setFeatureFlagAllowAll"
args = ["<%= formatBytes32String('createPool') %>", true]
