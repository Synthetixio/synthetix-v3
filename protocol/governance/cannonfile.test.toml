name = "synthetix-governance"
version = "<%= package.version %>-testable"
include = ["cannonfile.toml"]

[setting.wormhole_chain_id]
defaultValue = "10002"

[setting.wormhole_core]
defaultValue = "0xBc9C458D6294a40599FB3485fB079429C0732833"

[setting.wormhole_relayer]
defaultValue = "0x4235288801B10D43d381E1a7ff495c44EbDD669a"

[contract.SnapshotRecordMock]
artifact = "contracts/mocks/SnapshotRecordMock.sol:SnapshotRecordMock"

# Testable storage contracts
[contract.TestableCouncilStorage]
artifact = "contracts/generated/test/TestableCouncilStorage.sol:TestableCouncilStorage"

[contract.TestableBallotStorage]
artifact = "contracts/generated/test/TestableBallotStorage.sol:TestableBallotStorage"

[contract.TestableSnapshotVotePowerStorage]
artifact = "contracts/generated/test/TestableSnapshotVotePowerStorage.sol:TestableSnapshotVotePowerStorage"

[contract.TestableElectionSettingsStorage]
artifact = "contracts/generated/test/TestableElectionSettingsStorage.sol:TestableElectionSettingsStorage"

[contract.TestableElectionStorage]
artifact = "contracts/generated/test/TestableElectionStorage.sol:TestableElectionStorage"

[contract.TestableEpochStorage]
artifact = "contracts/generated/test/TestableEpochStorage.sol:TestableEpochStorage"

[contract.WormholeMock]
artifact = "contracts/mocks/WormholeMock.sol:WormholeMock"
args = ["<%= settings.wormhole_chain_id %>"]
create2 = true

[contract.WormholeRelayerMock]
artifact = "contracts/mocks/WormholeRelayerMock.sol:WormholeRelayerMock"
args = ["<%= settings.wormhole_core %>"]
create2 = true

# Core Router + Testable modules
[router.TestRouter]
contracts = [
    # Extend Original Core Router
    "CoreRouter",
    # Testable storage contracts
    "TestableCouncilStorage",
    "TestableBallotStorage",
    "TestableSnapshotVotePowerStorage",
    "TestableElectionSettingsStorage",
    "TestableElectionStorage",
    "TestableEpochStorage",
]

[invoke.upgrade_core_proxy]
target = ["InitialProxy"]
from = "<%= settings.owner %>"
func = "upgradeTo"
args = ["<%= contracts.TestRouter.address %>"]
factory.GovernanceProxy.abiOf = ["TestRouter"]
factory.GovernanceProxy.event = "Upgraded"
factory.GovernanceProxy.arg = 0
factory.GovernanceProxy.highlight = true
