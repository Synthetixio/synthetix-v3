name = "synthetix-governance"
description = "On-chain voting for synthetix councils"
version = "<%= package.version %>"

[setting.salt]
defaultValue = "governance"

# Deployment Owner, defaults to first hardhat account
[setting.owner]
defaultValue = "0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266"

[setting.council_token_name]
defaultValue = "Synthetix Governance Module"

[setting.council_token_symbol]
defaultValue = "SNXGOV"

[setting.init_council_member]
defaultValue = "0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266" # can only specify 1

[setting.epoch_seat_count]
defaultValue = "2"

[setting.minimum_active_members]
defaultValue = "1"

[setting.nomination_period_start_date]
defaultValue = "0" # defaults to "block.timestamp + epoch_duration - (voting_period_duration * 2)" when given "0"

[setting.voting_period_duration]
defaultValue = "7" # days

[setting.epoch_duration]
defaultValue = "90" # days

[setting.max_date_adjustment_tolerance]
defaultValue = "3" # days

[contract.InitialModuleBundle]
artifact = "contracts/modules/core/InitialModuleBundle.sol:InitialModuleBundle"
create2 = true

[contract.InitialProxy]
artifact = "contracts/Proxy.sol:Proxy"
args = ["<%= contracts.InitialModuleBundle.address %>", "<%= settings.owner %>"]
salt = "<%= settings.salt %>"
abiOf = ["InitialModuleBundle"]
create2 = true
depends = ["contract.InitialModuleBundle"]

[contract.AssociatedSystemsModule]
artifact = "contracts/modules/core/AssociatedSystemsModule.sol:AssociatedSystemsModule"

[contract.ElectionInspectorModule]
artifact = "contracts/modules/core/ElectionInspectorModule.sol:ElectionInspectorModule"

[contract.ElectionModule]
artifact = "contracts/modules/core/ElectionModule.sol:ElectionModule"

[contract.OwnerModule]
artifact = "contracts/modules/core/OwnerModule.sol:OwnerModule"

[contract.UpgradeProposalModule]
artifact = "contracts/modules/core/UpgradeProposalModule.sol:UpgradeProposalModule"

[contract.SnapshotVotePowerModule]
artifact = "contracts/modules/core/SnapshotVotePowerModule.sol:SnapshotVotePowerModule"

[contract.CouncilTokenModule]
artifact = "contracts/modules/council-nft/CouncilTokenModule.sol:CouncilTokenModule"

[router.CoreRouter]
contracts = [
  "AssociatedSystemsModule",
  "ElectionInspectorModule",
  "ElectionModule",
	"SnapshotVotePowerModule",
  "OwnerModule",
  "UpgradeProposalModule",
]
depends = [
  "contract.AssociatedSystemsModule",
  "contract.ElectionInspectorModule",
  "contract.ElectionModule",
	"contract.SnapshotVotePowerModule",
  "contract.OwnerModule",
  "contract.UpgradeProposalModule",
]

[invoke.upgrade_core_proxy]
target = ["InitialProxy"]
from = "<%= settings.owner %>"
func = "upgradeTo"
args = ["<%= contracts.CoreRouter.address %>"]
factory.CoreProxy.abiOf = ["CoreRouter"]
factory.CoreProxy.event = "Upgraded"
factory.CoreProxy.arg = 0
depends = ["contract.InitialProxy", "router.CoreRouter"]

[router.CouncilTokenRouter]
contracts = [
  "CouncilTokenModule",
  "InitialModuleBundle",
]
depends = [
  "contract.CouncilTokenModule",
  "contract.InitialModuleBundle"
]

[invoke.init_council_token]
target = ["CoreProxy"]
from = "<%= settings.owner %>"
func = "initOrUpgradeNft"
args = [
  "<%= formatBytes32String('councilToken') %>",
  "Synthetix Governance Token",
  "SNXGOV",
  "https://synthetix.io",
  "<%= contracts.CouncilTokenRouter.address %>"
]
depends = [
  "invoke.upgrade_core_proxy",
  "router.CouncilTokenRouter"
]
factory.CouncilToken.abiOf = ["CouncilTokenRouter"]
factory.CouncilToken.event = "AssociatedSystemSet"
factory.CouncilToken.arg = 2

[invoke.init_election_module]
target = ["CoreProxy"]
func = "initOrUpgradeElectionModule(address[],uint8,uint8,uint64,uint64,uint64,uint64)"
args = [
  ["<%= settings.init_council_member %>"],
  "<%= settings.epoch_seat_count %>",
  "<%= settings.minimum_active_members %>",
  "<%= settings.nomination_period_start_date %>",
  "<%= settings.voting_period_duration %>",
  "<%= settings.epoch_duration %>",
  "<%= settings.max_date_adjustment_tolerance %>",
]
from = "<%= settings.owner %>"
depends = ["invoke.init_council_token"]
