name = "synthetix-governance"
description = "On-chain voting for synthetix councils"
version = "<%= package.version %>"

[var.main]
salt = "governance"
# Deployment Owner, defaults to first hardhat account
owner = "0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266"
council_token_name = "Synthetix Governance Module"
council_token_symbol = "SNXGOV"
init_council_member = "0xf39fd6e51aad88f6f4ce6ab8827279cfffb92266"
epoch_start = ""
epoch_duration = ""
voting_period_duration = "7"

[deploy.InitialModuleBundle]
artifact = "InitialModuleBundle"
create2 = true

[deploy.InitialProxy]
artifact = "contracts/Proxy.sol:Proxy"
args = ["<%= contracts.InitialModuleBundle.address %>", "<%= settings.owner %>"]
salt = "<%= settings.salt %>"
abiOf = ["InitialModuleBundle"]
create2 = true

[deploy.AssociatedSystemsModule]
artifact = "contracts/modules/core/AssociatedSystemsModule.sol:AssociatedSystemsModule"

[deploy.ElectionModule]
artifact = "ElectionModule"

[deploy.ElectionInspectorModule]
artifact = "ElectionInspectorModule"

[deploy.CouncilTokenModule]
artifact = "CouncilTokenModule"

[deploy.DebtShareMock]
artifact = "DebtShareMock"

[router.CoreRouter]
contracts = [
    "AssociatedSystemsModule",
    "ElectionModule",
    "ElectionInspectorModule",
    "InitialModuleBundle",
]

[invoke.upgrade_core_proxy]
target = ["InitialProxy"]
from = "<%= settings.owner %>"
func = "upgradeTo"
args = ["<%= contracts.CoreRouter.address %>"]
factory.CoreProxy.abiOf = ["CoreRouter"]
factory.CoreProxy.event = "Upgraded"
factory.CoreProxy.arg = 0

[router.CouncilTokenRouter]
contracts = ["CouncilTokenModule", "InitialModuleBundle"]

[invoke.init_council_token]
target = ["CoreProxy"]
from = "<%= settings.owner %>"
func = "initOrUpgradeNft"
args = [
    "<%= formatBytes32String('councilToken') %>",
    "Synthetix Governance Token",
    "SNXGOV",
    "https://synthetix.io",
    "<%= contracts.CouncilTokenRouter.address %>",
]
depends = ["invoke.upgrade_core_proxy", "router.CouncilTokenRouter"]
factory.AccountProxy.abiOf = ["CouncilTokenRouter"]
factory.AccountProxy.event = "AssociatedSystemSet"
factory.AccountProxy.arg = 2

[invoke.init_election_module]
target = ["CoreProxy"]
func = "initOrUpgradeElectionModule(address[],uint8,uint64,uint64,uint64,address)"
args = [
    [
        "<%= settings.init_council_member %>",
    ],
    "1",
    "<%= settings.epoch_start %>",
    "<%= settings.epoch_start + 86400 * settings.voting_period_duration %>",
    "<%= settings.epoch_start + 86400 * settings.epoch_duration %>",
    "<%= contracts.DebtShareMock.address %>",
]
from = "<%= settings.owner %>"

[clone.trusted_multicall_forwarder]
source = "trusted-multicall-forwarder"
